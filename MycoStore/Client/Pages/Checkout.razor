@page "/checkout"
@using System.ComponentModel.DataAnnotations
@using MycoStore.Client.Services
@using MycoStore.Shared
@inject CartService CartService
@inject NavigationManager Navigation

<h3>Checkout</h3>

@if (!CartService.GetCartItems().Any())
{
    <p>Your cart is empty. <NavLink href="/mushrooms">Go back to shop.</NavLink></p>
}
else
{
    <EditForm Model="@customer" OnValidSubmit="PlaceOrder">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label>Name</label>
            <InputText class="form-control" @bind-Value="customer.Name" />
        </div>

        <div class="mb-3">
            <label>Email</label>
            <InputText class="form-control" @bind-Value="customer.Email" />
        </div>

        <div class="mb-3">
            <label>Address</label>
            <InputText class="form-control" @bind-Value="customer.Address" />
        </div>

        <h5 class="mt-3">Total: @CartService.GetTotalPrice().ToString("C", System.Globalization.CultureInfo.GetCultureInfo("fr-FR"))</h5>

        <button type="submit" class="btn btn-success mt-3">Place Order</button>
    </EditForm>
}

@code {
    private CustomerInfo customer = new();

    private void PlaceOrder()
    {
        CartService.ClearCart();
        Navigation.NavigateTo("/order-confirmation");
    }

    public class CustomerInfo
    {
        [Required] public string Name { get; set; } = "";
        [Required, EmailAddress] public string Email { get; set; } = "";
        [Required] public string Address { get; set; } = "";
    }
}
